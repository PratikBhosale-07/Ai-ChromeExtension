# Genie — Chrome Extension

A free, private, universal AI assistant side panel for Chrome.  
Capture text & images from any webpage and chat with ChatGPT, Gemini, Claude, or Perplexity — without switching tabs.

---

## Feature Overview

| Feature                                                                | Status |
| ---------------------------------------------------------------------- | ------ |
| Side panel (Chrome sidePanel API)                                      | ✅     |
| AI provider switcher (ChatGPT / Gemini / Claude / Perplexity / Custom) | ✅     |
| Text selection → auto-capture float button                             | ✅     |
| Right-click → "Send to Genie"                                          | ✅     |
| Right-click image → "Analyze image with AI"                            | ✅     |
| Keyboard shortcuts (Ctrl+Shift+A / S)                                  | ✅     |
| Capture queue with send / copy / delete                                | ✅     |
| Pause / Resume capture toggle                                          | ✅     |
| Presentation mode (hide panel during screen share)                     | ✅     |
| Dark / Light theme                                                     | ✅     |
| Auto-send on capture toggle                                            | ✅     |
| Custom AI URL support                                                  | ✅     |
| 100% local — no server, no API keys, no tracking                       | ✅     |

---

## Folder Structure

```
AIextension/
├── manifest.json          # MV3 manifest — permissions, commands, CSP
├── background.js          # Service worker — context menus, panel bridge, state
├── contentScript.js       # Injected into pages — selection capture, float button
├── panel.html             # Side panel UI markup
├── panel.js               # Panel logic — AI switching, injection, queue, settings
├── styles.css             # Dark-first design system
└── icons/
    ├── icon.svg           # Master SVG icon
    ├── chatgpt.svg        # Provider chip icons
    ├── gemini.svg
    ├── claude.svg
    ├── perplexity.svg
    ├── generate-icons.html  ← Open in Chrome to export icon16/32/48/128.png
    ├── icon16.png         # ← generated by you (see Setup step 2)
    ├── icon32.png
    ├── icon48.png
    └── icon128.png
```

---

## Setup & Installation

### Step 1 — Generate PNG icons

1. Open `icons/generate-icons.html` in Chrome (drag-and-drop to address bar or `File > Open`)
2. Click **Generate & Download All**
3. Move the four downloaded PNGs (`icon16.png`, `icon32.png`, `icon48.png`, `icon128.png`) into the `icons/` folder

### Step 2 — Load the extension

1. Open Chrome and navigate to `chrome://extensions`
2. Enable **Developer mode** (toggle, top-right)
3. Click **Load unpacked**
4. Select the `AIextension/` folder
5. The extension installs — pin it to the toolbar

### Step 3 — Open the panel

- Click the Genie toolbar icon, **or**
- Press `Ctrl+Shift+A` (Windows/Linux) / `Cmd+Shift+A` (Mac)

---

## How to Use

### Capture selected text

| Method            | Action                                              |
| ----------------- | --------------------------------------------------- |
| Float button      | Select text → click the purple **Ask Genie** button |
| Right-click menu  | Select text → right-click → **Send to Genie**       |
| Keyboard shortcut | Select text → `Ctrl+Shift+S`                        |

### Capture an image

Right-click any image → **Analyze image with AI**

### Paste into AI chat

The captured content is written to your clipboard and the AI iframe is focused.  
Press **Ctrl+V** in the chat input to paste, or enable **Auto-send** in Settings (the extension will attempt automatic paste).

### Switch AI provider

Click a chip in the selector bar: **ChatGPT · Gemini · Claude · Perplexity · Custom**

### Capture queue

Click **Captured [n]** drawer at the bottom of the panel to see all captured items.  
Each item has **Send**, **Copy**, and **Delete** actions.

### Pause capture

Click the **⏸ Pause** button in the header, or right-click anywhere → **⏸ Pause AI Capture**.  
The float button will stop appearing and auto-send is suspended.

### Presentation mode (screen share)

Click the **eye-slash** icon in the header.  
All panel content is replaced with a blank screen, keeping your AI chat invisible during recordings or screen shares.  
Click **Show panel** inside the overlay to return.

---

## Architecture & Message Flow

```
┌─────────────────────────────────────────────────────────────┐
│  WEBPAGE                                                    │
│  ┌─────────────────────────────────────┐                   │
│  │  contentScript.js                   │                   │
│  │  • Monitors mouseup / keyup         │                   │
│  │  • Shows float button on selection  │                   │
│  │  • Sends AUTO_CAPTURE message       │                   │
│  └──────────────┬──────────────────────┘                   │
└─────────────────│───────────────────────────────────────────┘
                  │ chrome.runtime.sendMessage
                  ▼
┌─────────────────────────────────────────────────────────────┐
│  background.js  (Service Worker)                            │
│  • Receives AUTO_CAPTURE / context menu events              │
│  • Opens sidePanel if closed                                │
│  • Forwards CAPTURE_PAYLOAD to panel                        │
│  • Manages captureEnabled state                             │
└──────────────────────────────┬──────────────────────────────┘
                               │ chrome.runtime.sendMessage
                               ▼
┌─────────────────────────────────────────────────────────────┐
│  panel.js  (Side Panel)                                     │
│  • Receives CAPTURE_PAYLOAD                                 │
│  • Writes to clipboard (navigator.clipboard.writeText)      │
│  • Focuses AI iframe                                        │
│  • Shows capture queue                                      │
│  • Manages AI selector, settings, presentation mode        │
└──────────────────────────────┬──────────────────────────────┘
                               │ iframe src=
                               ▼
                  ┌────────────────────────┐
                  │  AI Website (iframe)   │
                  │  chatgpt.com           │
                  │  gemini.google.com     │
                  │  claude.ai             │
                  │  perplexity.ai         │
                  └────────────────────────┘
```

---

## AI Injection Strategy

Because AI websites are cross-origin, direct DOM injection into the iframe is blocked by browser security.  
The extension uses the **Clipboard Bridge**:

1. Captured text/image URL is formatted into a prompt string
2. `navigator.clipboard.writeText(prompt)` writes it to clipboard
3. The AI iframe is focused
4. A `Ctrl+V` keyboard event is dispatched
5. Modern AI chat inputs receive the paste

For sites that intercept keyboard events differently, the user can manually paste with `Ctrl+V` after the toast notification appears.

---

## Permissions Explained

| Permission                     | Why                                                    |
| ------------------------------ | ------------------------------------------------------ |
| `activeTab`                    | Read current tab URL for source attribution            |
| `scripting`                    | Execute selection-capture script via keyboard shortcut |
| `contextMenus`                 | "Send to AI" right-click menus                         |
| `storage`                      | Persist settings & state locally                       |
| `sidePanel`                    | Open the Chrome side panel                             |
| `clipboardWrite`               | Write captured content to clipboard                    |
| `clipboardRead`                | Read clipboard for optional processing                 |
| `host_permissions: <all_urls>` | Allow content script on all pages                      |

No data is ever sent to any external server. Everything is local.

---

## Keyboard Shortcuts

| Shortcut       | Action                    |
| -------------- | ------------------------- |
| `Ctrl+Shift+A` | Toggle side panel         |
| `Ctrl+Shift+S` | Capture current selection |

Customise at `chrome://extensions/shortcuts`.

---

## CSP & iframe Allowlist

The following AI sites are allowed in the panel iframe:

- `https://chatgpt.com`
- `https://chat.openai.com`
- `https://gemini.google.com`
- `https://claude.ai`
- `https://www.perplexity.ai`

To add more, edit the `content_security_policy.extension_pages` field in `manifest.json` and add the site URL to `AI_PROVIDERS` in `panel.js`.

---

## Chrome Web Store Compliance Notes

- Uses Manifest V3 (required for new submissions)
- Minimal permissions — no broad host permission abuse
- No remote code execution
- No data collection or external analytics
- All functionality works offline (except the AI sites themselves)
- `sidePanel` API requires Chrome 114+

---

## Future Upgrade Path (Paid API)

The architecture is ready for API integration:

1. Add `openai` / `anthropic` / `google-generativeai` calls in `panel.js`
2. Replace iframe with a custom chat UI component
3. Store API key in `chrome.storage.local` (encrypted)
4. Remove iframe CSP entries

---

## License

MIT — free to use, modify, and distribute.
